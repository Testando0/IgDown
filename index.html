<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kuromi Downloader | Premium</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/hls.js@latest"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root { 
        --neon-purple:#a855f7; 
        --neon-pink:#ff00aa; 
        --dark-bg:#050505; 
    }
    
    body { 
        font-family:'Outfit',sans-serif; 
        background:var(--dark-bg); 
        min-height:100vh; 
        color:#e4e4e7;
        background-image: 
            radial-gradient(circle at 50% 0%, rgba(168, 85, 247, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 0% 100%, rgba(255, 0, 170, 0.1) 0%, transparent 50%); 
        overflow-x: hidden;
    }

    /* Efeito de Vidro (Glassmorphism) */
    .dark-glass { 
        background: rgba(20, 20, 20, 0.7); 
        backdrop-filter: blur(12px); 
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(168, 85, 247, 0.2); 
        box-shadow: 0 0 30px rgba(0,0,0,0.5); 
    }

    .glow-focus:focus-within { 
        box-shadow: 0 0 25px rgba(168,85,247,0.25); 
        border-color: rgba(168,85,247,0.5); 
    }

    /* Anima√ß√µes */
    .loader { 
        border: 3px solid rgba(255,255,255,0.1); 
        border-left-color: var(--neon-pink); 
        border-radius: 50%; 
        width: 24px; height: 24px; 
        animation: spin 1s linear infinite; 
    }
    
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
    @keyframes fadeUp { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }
    
    .animate-fade-up { animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    
    .orbitron { font-family: 'Orbitron', sans-serif; }

    /* Player customizado */
    video { 
        border-radius: 12px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
  </style>
</head>

<body class="flex flex-col items-center justify-center p-4 md:p-8">

  <nav class="absolute top-0 left-0 w-full p-6 flex justify-between items-center max-w-7xl mx-auto z-10">
    <div class="flex items-center gap-3 text-xl font-bold tracking-wider">
      <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex items-center justify-center shadow-[0_0_15px_rgba(168,85,247,0.5)]">
        <i class="fa-solid fa-skull text-white text-lg"></i>
      </div>
      <span class="text-white orbitron">Kuromi<span class="text-purple-400">DL</span></span>
    </div>
    <div class="text-[10px] font-medium text-zinc-500 border border-zinc-800 px-3 py-1 rounded-full bg-zinc-900/50 tracking-widest">
      SYSTEM V2.0
    </div>
  </nav>

  <main class="w-full max-w-2xl mt-20 relative z-0">
    
    <div class="text-center mb-10 animate-fade-up">
      <h1 class="text-4xl md:text-6xl font-bold mb-4 text-white orbitron drop-shadow-[0_0_10px_rgba(168,85,247,0.5)]">
        Baixe <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">Reels</span>
      </h1>
      <p class="text-zinc-400 text-lg font-light">Cole o link, baixe sem redirecionar.</p>
    </div>

    <div class="dark-glass rounded-2xl p-2 mb-8 animate-fade-up glow-focus transition-all duration-300" style="animation-delay: 0.1s;">
      <div class="relative flex items-center">
        <div class="absolute left-4 text-purple-500 text-xl"><i class="fa-brands fa-instagram"></i></div>
        
        <input type="text" id="urlInput" 
          placeholder="Cole o Link do Instagram Aqui..." 
          class="w-full bg-transparent border-none text-zinc-100 placeholder-zinc-600 px-12 py-4 focus:ring-0 focus:outline-none text-lg font-light orbitron">
        
        <div class="absolute right-2 flex items-center gap-2">
          <button onclick="processDownload()" id="mainBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-lg shadow-purple-900/40 flex items-center gap-2 hover:scale-105 active:scale-95">
            <span id="btnText">BAIXAR</span>
            <div id="btnLoader" class="loader hidden"></div>
          </button>
        </div>
      </div>
    </div>

    <div id="resultArea" class="hidden animate-fade-up" style="animation-delay:0.2s;">
      <div class="dark-glass rounded-2xl p-6 border border-zinc-800 relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-64 h-64 bg-purple-600/10 rounded-full blur-3xl -z-10 pointer-events-none"></div>
        
        <div class="flex flex-col gap-6">
            <div class="relative w-full rounded-xl overflow-hidden border border-zinc-700 bg-black shadow-2xl">
                <video id="previewPlayer" class="w-full max-h-[450px]" controls playsinline></video>
            </div>

            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-left w-full">
                    <h3 class="text-xl font-bold text-white orbitron mb-1" id="resTitle">Sucesso!</h3>
                    <p class="text-purple-400 text-xs uppercase tracking-widest" id="resFilename">video_kuromi.mp4</p>
                </div>

                <div class="w-full md:w-auto flex flex-col gap-2">
                    <button id="btnDownloadFile" onclick="startBlobDownload()" class="w-full md:w-auto bg-white text-black hover:bg-gray-200 px-6 py-3 rounded-lg font-bold text-center transition flex items-center justify-center gap-2 shadow-[0_0_15px_rgba(255,255,255,0.2)]">
                        <i class="fa-solid fa-download"></i> <span id="dlBtnText">SALVAR NO DISPOSITIVO</span>
                        <div id="dlLoader" class="loader hidden border-zinc-400 border-l-black w-4 h-4"></div>
                    </button>
                    
                    <button onclick="resetApp()" class="w-full md:w-auto text-zinc-500 hover:text-white text-xs py-2 transition">
                        Baixar Outro V√≠deo
                    </button>
                </div>
            </div>
        </div>
      </div>
    </div>

    <div id="errorMsg" class="hidden mt-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl flex items-center gap-3 animate-fade-up backdrop-blur-md">
      <i class="fa-solid fa-circle-exclamation text-red-500"></i>
      <span id="errorText" class="text-red-200 text-sm font-medium">Erro ao processar.</span>
    </div>

  </main>

  <footer class="fixed bottom-6 text-center w-full text-zinc-700 text-[10px] tracking-[0.3em] pointer-events-none orbitron">
    POWERED BY KUROMI TECH
  </footer>

<script>
/* ================= CONFIGURA√á√ÉO ================= */
// URL do Proxy para evitar bloqueio de CORS (Necess√°rio para download direto)
const PROXY_URL = 'https://corsproxy.io/?';

// API da Kuromi (Do seu case original)
const KUROMI_API = 'https://kuromi-system-tech.onrender.com/api/insta?url=';

/* =============== VARI√ÅVEIS DE ESTADO ============== */
let foundVideoUrl = ''; // Armazena o link direto do v√≠deo encontrado

/* =============== ELEMENTOS DO DOM ================ */
const urlInput = document.getElementById('urlInput');
const mainBtn = document.getElementById('mainBtn');
const btnText = document.getElementById('btnText');
const btnLoader = document.getElementById('btnLoader');
const resultArea = document.getElementById('resultArea');
const errorMsg = document.getElementById('errorMsg');
const errorText = document.getElementById('errorText');
const previewPlayer = document.getElementById('previewPlayer');
const btnDownloadFile = document.getElementById('btnDownloadFile');
const dlBtnText = document.getElementById('dlBtnText');
const dlLoader = document.getElementById('dlLoader');

/* =============== FUN√á√ïES PRINCIPAIS =============== */

// 1. Processar Input e Buscar na API
async function processDownload(){
    const rawUrl = urlInput.value.trim();

    // Resetar UI
    resetUI();

    if(!rawUrl) { 
        showError('Por favor, insira um link v√°lido! üíú'); 
        return; 
    }

    setSearchLoading(true);

    try {
        // Monta a URL da API + Proxy
        const targetApiUrl = KUROMI_API + encodeURIComponent(rawUrl);
        const fetchUrl = PROXY_URL + encodeURIComponent(targetApiUrl);

        console.log("Buscando em:", targetApiUrl);

        const res = await fetch(fetchUrl);
        
        if(!res.ok) throw new Error(`Erro HTTP: ${res.status}`);

        const json = await res.json();

        // L√≥gica de Valida√ß√£o do seu Case Original
        if (!json || !json.data || !Array.isArray(json.data.data)) {
            throw new Error("N√£o encontrei o v√≠deo. Link privado ou inv√°lido üôÅ");
        }
        
        const mediaArray = json.data.data;
        if (mediaArray.length < 1) {
            throw new Error("Nenhuma m√≠dia encontrada nesse link üôÅ");
        }

        // Sucesso! Pegamos o primeiro v√≠deo
        const videoData = mediaArray[0];
        foundVideoUrl = videoData.url;

        // Mostrar resultado
        showResult(foundVideoUrl);

    } catch (error) {
        console.error(error);
        let msg = error.message;
        
        // Tratamento amig√°vel de erros comuns
        if(msg.includes('Failed to fetch')) {
            msg = "A API da Kuromi est√° dormindo (Render). Tente de novo em 1 min! üí§";
        } else if (!msg.includes("üôÅ")) {
            msg = "Ocorreu um erro desconhecido no sistema. üíî";
        }
        
        showError(msg);
    } finally {
        setSearchLoading(false);
    }
}

// 2. Download do Arquivo (Blob) - O Segredo para n√£o redirecionar
async function startBlobDownload() {
    if(!foundVideoUrl) return;

    setDownloadLoading(true);

    try {
        // Usamos o Proxy para baixar o arquivo de v√≠deo sem bloqueio do Instagram
        // Se o link j√° tiver 'scontent', usamos proxy.
        const videoProxyUrl = PROXY_URL + encodeURIComponent(foundVideoUrl);

        const response = await fetch(videoProxyUrl);
        if (!response.ok) throw new Error("Falha ao baixar o arquivo bruto.");

        // Transforma em Blob (Arquivo na mem√≥ria RAM)
        const blob = await response.blob();
        
        // Cria link tempor√°rio
        const tempUrl = window.URL.createObjectURL(blob);
        const filename = `kuromi_video_${Date.now()}.mp4`;

        // For√ßa o clique no link tempor√°rio
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = tempUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        
        // Limpeza
        window.URL.revokeObjectURL(tempUrl);
        a.remove();

    } catch (error) {
        console.error("Erro no download blob:", error);
        alert("Erro ao salvar arquivo. O Instagram pode ter bloqueado o proxy temporariamente. Tente novamente.");
    } finally {
        setDownloadLoading(false);
    }
}

/* =============== FUN√á√ïES DE UI =============== */

function showResult(url) {
    previewPlayer.src = url;
    resultArea.classList.remove('hidden');
    // Rolar suavemente at√© o resultado
    resultArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function showError(msg) {
    errorText.innerText = msg;
    errorMsg.classList.remove('hidden');
    // Efeito de tremor
    errorMsg.classList.add('animate-pulse');
    setTimeout(() => errorMsg.classList.remove('animate-pulse'), 500);
}

function resetUI() {
    errorMsg.classList.add('hidden');
    resultArea.classList.add('hidden');
    previewPlayer.pause();
    previewPlayer.src = "";
    foundVideoUrl = "";
}

function resetApp() {
    resetUI();
    urlInput.value = "";
    urlInput.focus();
}

// Controle de Estado dos Bot√µes
function setSearchLoading(isLoading) {
    if(isLoading) {
        btnText.classList.add('hidden');
        btnLoader.classList.remove('hidden');
        mainBtn.disabled = true;
        mainBtn.classList.add('opacity-70', 'cursor-not-allowed');
    } else {
        btnText.classList.remove('hidden');
        btnLoader.classList.add('hidden');
        mainBtn.disabled = false;
        mainBtn.classList.remove('opacity-70', 'cursor-not-allowed');
    }
}

function setDownloadLoading(isLoading) {
    if(isLoading) {
        dlBtnText.innerText = "BAIXANDO...";
        dlLoader.classList.remove('hidden');
        btnDownloadFile.disabled = true;
    } else {
        dlBtnText.innerText = "SALVAR NO DISPOSITIVO";
        dlLoader.classList.add('hidden');
        btnDownloadFile.disabled = false;
    }
}

// Atalho para tecla Enter
urlInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') processDownload();
});

</script>
</body>
</html>
